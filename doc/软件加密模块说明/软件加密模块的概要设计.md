# 软件加密模块的概要设计


```
本文档为软件加密注册模块简要的设计文档，主要是为了其他人更好的理解本模块的设计思想和实现流程，也为了自己在以后修改过中能够快速熟悉模块的设计,避繁就简,就没再严格按照概要设计模板来编写.
```

******

## 1. 设计文档背景

>
该文档的设计是依据《软件加密模块的需求》来进行的设计，主要是为了解决需求中的问题，若是超过该需求的问题，可能该模块就有些不在适宜。

******

## 2. 模块使用场景

![软件总体架构图](./软件加密模块文档资源/软件加密模块架构设计图.png)


## 3. 模块基础划分

******

> * 用户信息生成子模块
> * 加解密子模块
> * UI提示接口子模块
> * 注册码的产生和验证子模块

******

### 3.1 模块间关系
![软件模块架构图](./软件加密模块文档资源/软件加密模块模块架构图.png)


### 3.2 用户信息生成子模块

> 
用户信息生成子模块用来收集用户的信息确保用户的全球唯一性，最终该文件是做为产生注册码的源文件，关于该模块的说明如下：

* 用户信息子模块最终产生为一个后缀为.userinfo的文件
* 文件内容需要经过加密子模块进行加密
* 用户信息主要包括如下内容：
 * 用户网卡MAC
 * 用户CPU信息(CPU个数)
 * 当前时间(距离1970年的秒数)
 * 硬盘硬件序列号
 * 系统版本代号
 * 用户程序ID(全球唯一标识符)


### 3.3 加解密子模块

> 
负责给予其他模块提供基础的加解密和校验的接口

### 3.4 UI提示接口子模块

>
负责给其他模块提供交互界面的接口，用来传递内部信息给用户和接受用户的反馈信息

* 消息提示框(通知、警告、错误)

### 3.5 注册码的产生和验证子模块

>
负责记录用户的唯一标识和用户权限

#### 3.5.1 注册码格式说明
|2 byte|16 byte|16 byte|8 byte|8 byte|2 byte|2 byte|2 byte|
|:----:|:----:|:----:|:----:|:----:|:----:|:----:|:----:|
|用户类型|用户唯一识别码|软件唯一识别码|开始时间|结束时间|使用次数|转换算法代码|完整性校验|

* 用户类型
 * ```0x00 0x01``` 时间限制型用户
 * ```0x00 0x02``` 次数限制型用户
 * ```0x00 0x03```-```0xff 0xff```保留类型 
* 用户唯一识别码
 * 原始串 = MAC地址 + 硬盘序列号 + CPU个数 + 系统版本代码
 * 原始串进行摘要算法得到16字节的```数字指纹```
* 软件唯一识别码
 * 软件GUID 16字节
* 开始时间
 * Unix时间，距离1970年的秒数
* 结束时间
 * Unix时间，距离1970年的秒数
* 使用次数
 * 无符号短整型
* 转换算法代码
 * 内部完整性校验前的字节转换算法代号
* 完整性校验
 * 常规的完整性校验

### 3.6 校时模块

> 负责确保时间的相对正确性，时间出现较大偏差时会进行联网纠正，或者离线估算纠正。



